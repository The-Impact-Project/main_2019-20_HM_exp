---
title: "Maine Survey Results"
author: "Andy Zack"
date: "11/26/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

We got 895 survey responses in Maine. After dropping those where the gender or age of the respondent did not match what we have on file, we were left with 854 completed surveys. For this memo, I weighted the results by education, ticket splitter score, experimental assignmnet (control vs. treatment), and gender.

The plan is to combine these results with the results from the other states where we plan on running surveys next month. This just contains some preliminary data. Except for the recall question (Q7), most of the differences between the control and treatment group are not significant.


```{r prepare_data, echo=FALSE, message=FALSE, warning=FALSE}
# Load Packages ----------------------------------------------------------
library(TIPtools)
library(tidyverse)
library(civis)
library(here)

maine_dems <- c(14)

amm_results <- read_csv(here("data", "TMC_ME_Return_1122_1124.csv")) %>%
  filter(FDISP=="01") %>%
  as_tibble() %>%
  select(DATE, TIME, duration, starts_with("Q"), vb_voterbase_id)

randomized_dat <- readRDS(here("output", "all_randomized_dat.Rds")) %>%
  filter(vb_tsmart_state == "ME") %>%
  filter(assignment %in% c("treatment", "control")) %>%
  mutate(maine_ticket_splitter = fct_explicit_na(maine_ticket_splitter))

```

```{r process_data, echo=FALSE, message=FALSE, warning=FALSE}

# merge to voter file
survey_results <- amm_results %>%
  left_join(randomized_dat, by = "vb_voterbase_id") %>%
  mutate(Qgender = recode(as.character(Q2), 
                                   "1" = "Male",
                                   "2" = "Female"),
         year_difference = (floor(vb_voterbase_dob/10000)) - Q8,
         Qfav_binary = recode(as.character(Q3), 
                       "1" = "Favorable",
                       "2" = "Unfavorable",
                       "7777" = "Never Heard",
                       "8888" = "Don't Know"),
         Qfav_modifier = recode(as.character(Q4),
                       "1" = "Strongly",
                       "2" = "Somewhat",
                       "8888" = "Somewhat"),
         Qfav = as_factor(str_remove(string = paste(Qfav_modifier, Qfav_binary), pattern = "NA ")),
         Qfav = fct_relevel(Qfav, 
                            "Strongly Favorable",
                            "Somewhat Favorable",
                            "Never Heard",
                            "Don't Know",
                            "Somewhat Unfavorable",
                            "Strongly Unfavorable"),
         Qmaine_issue = recode(as.character(Q5),
                              "1" = "Strongly Support",
                              "2" = "Somewhat Support",
                              "3" = "Somewhat Oppose",
                              "4" = "Strongly Oppose",
                              "8888" = "Don't Know"),
         Qapproach = recode(as.character(Q6),
                            "1" = "Keeping taxes low",
                            "2" = "Investing in schools",
                            "3" = "Both",
                            "4" = "Something else",
                            "8888" = "Don't Know"),
         Qrecall = recode(as.character(Q7),
                          "1" = "Yes",
                          "2" = "No",
                          "8888" = "Don't Know")) %>%
  filter(vb_voterbase_gender == "Unknown" | (vb_voterbase_gender == Qgender)) %>%
  filter(Q8 > 5000 | abs(year_difference < 3)) %>%
  mutate(Qgender = factor(Qgender),
         Qmaine_issue = factor(Qmaine_issue, levels = c("Strongly Support", "Somewhat Support", "Don't Know", "Somewhat Oppose", "Strongly Oppose")),
         Qapproach = factor(Qapproach, levels = c("Investing in schools", "Both", "Don't Know", "Something else", "Keeping taxes low")),
         Qrecall = factor(Qrecall, levels = c("Yes", "Don't Know", "No"))) %>%
  mutate(Qfav_flipped = if_else(!vb_tsmart_sd %in% maine_dems,
                                fct_recode(Qfav,
                                          `Strongly Favorable` = "Strongly Unfavorable",
                                          `Somewhat Favorable` = "Somewhat Unfavorable",
                                          `Strongly Unfavorable` = "Strongly Favorable",
                                          `Somewhat Unfavorable` = "Somewhat Favorable"),
                                Qfav)) %>%
  weight_data(universe_dataset = randomized_dat,
              max_weight = 3,
              assignment,
              college,
              maine_ticket_splitter,
              vb_voterbase_gender) %>%
  select(-c(Qfav_binary, Qfav_modifier))

```


### Favorability

For this question, I flipped the responses for people in the three districts where the State Senator is not with us on the issues. Therefore, we are always trying to push people _towards_ favorable.

**Q3.** I’d like you to rate your feelings toward a public figure. Would you say you have a favorable or an unfavorable opinion of State Senator [Senator]? If you have no opinion or have never heard of [Senator], please just say so.

**Q4.** And would you say you have a strongly [favorable/unfavorable] opinion of State Senator [Senator], or just a somewhat [favorable/unfavorable] opinion of [Senator]?

```{r fav, echo=FALSE, fig.height=2.5}
survey_results %>%
  group_by(assignment, Qfav_flipped) %>%
  summarise(n = sum(weight)) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=assignment, fill=Qfav_flipped, y = freq)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  scale_fill_manual(values = c("#d01c8b",
                               "#f1b6da",
                               "#d5d5d5",
                               "#bababa",
                               "#b8e186",
                               "#4dac26")) +
  scale_y_continuous(labels = scales::percent_format()) +
  coord_flip() +
  theme_minimal() +
  theme(legend.position="top",
        legend.title = element_blank()) +
  geom_text(aes(label = if_else(freq >= 0.05, 
                                scales::percent(freq, accuracy = 1),
                                "")), 
            position = position_stack(vjust = 0.5, 
                                      reverse = TRUE))
```

Q5. Now I’d like to ask you to rate your personal feelings on an issue. The Maine state legislature recently passed a law to help ensure that men and women get paid the same amount for equal work. Do you strongly support, somewhat support, somewhat oppose, or strongly oppose this law?

```{r equal_pay, echo=FALSE, fig.height=2.5}
survey_results %>%
  group_by(assignment, Qmaine_issue) %>%
  summarise(n = sum(weight)) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=assignment, fill=Qmaine_issue, y = freq)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  scale_fill_manual(values = c("#d01c8b",
                               "#f1b6da",
                               "#bababa",
                               "#b8e186",
                               "#4dac26")) +
  scale_y_continuous(labels = scales::percent_format()) +
  coord_flip() +
  theme_minimal() +
  theme(legend.position="top",
        legend.title = element_blank()) +
  geom_text(aes(label = if_else(freq >= 0.05, 
                                scales::percent(freq, accuracy = 1),
                                "")), 
            position = position_stack(vjust = 0.5, 
                                      reverse = TRUE))
```

Q6. Next, which approach do you think would be better for Maine’s government: 

 - Keeping taxes low for the middle class, and reducing burdensome regulations and taxes, or 
 - Ensuring big corporations and the wealthy pay their fair share so we can invest in schools, roads, and infrastructure, and expand access to affordable health care?

```{r approach, echo=FALSE, fig.height=2.5}
survey_results %>%
  mutate(Qapproach = fct_recode(Qapproach,
                                `Both/Don't Know/Something Else` = "Both",
                                `Both/Don't Know/Something Else` = "Don't Know",
                                `Both/Don't Know/Something Else` = "Something else")) %>%
  group_by(assignment, Qapproach) %>%
  summarise(n = sum(weight)) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=assignment, fill=Qapproach, y = freq)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  scale_fill_manual(values = c("#d01c8b",
                               "#bababa",
                               "#4dac26")) +
  scale_y_continuous(labels = scales::percent_format()) +
  coord_flip() +
  theme_minimal() +
  theme(legend.position="top",
        legend.title = element_blank()) +
  geom_text(aes(label = if_else(freq >= 0.05, 
                                scales::percent(freq, accuracy = 1),
                                "")), 
            position = position_stack(vjust = 0.5, 
                                      reverse = TRUE))
```

Q7. In the last several weeks, did you receive any mail about issues that the state legislature is working on in Maine?

```{r recall, echo=FALSE, fig.height=2.5}
survey_results %>%
  group_by(assignment, Qrecall) %>%
  summarise(n = sum(weight)) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=assignment, fill=Qrecall, y = freq)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  scale_fill_manual(values = c("#d01c8b",
                               "#bababa",
                               "#4dac26")) +
  scale_y_continuous(labels = scales::percent_format()) +
  coord_flip() +
  theme_minimal() +
  theme(legend.position="top",
        legend.title = element_blank()) +
  geom_text(aes(label = if_else(freq >= 0.05, 
                                scales::percent(freq, accuracy = 1),
                                "")), 
            position = position_stack(vjust = 0.5, 
                                      reverse = TRUE))
```

